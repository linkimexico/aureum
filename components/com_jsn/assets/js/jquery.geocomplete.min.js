(function(a,b,c,d){function e(i,j){this.options=a.extend(!0,{},f,j),this.input=i,this.$input=a(i),this._defaults=f,this._name="geocomplete";var k=this.options.details,l=this.options.detailsAttribute,m=this.options.map;if(this.init(),(this.options.addReset||this.options.addPosition)&&this.options.wrap&&this.$input.wrap("<div class=\"input-prepend\" />"),a(i).blur(function(){""==a(k+" ["+l+"='lat']").val()&&a(i).val("")}),this.options.addPosition){var n=navigator.geolocation!==d;n&&(this.$input.before("<a class=\"btn btn-success\" id=\""+l+"-geolocation\"><i class=\"jsn-icon jsn-icon-map-marker\"></i></a>"),a("#"+l+"-geolocation").click(function(){return navigator.geolocation.getCurrentPosition(function(o){a(i).geocomplete("init"),a(i).geocomplete("geocode",{address:o.coords.latitude+","+o.coords.longitude})}),!1}))}this.options.addReset&&(this.$input.before("<a class=\"btn btn-danger\" id=\""+l+"-reset\"><i class=\"jsn-icon jsn-icon-remove\"></i></a>"),a("#"+l+"-reset").click(function(){return a(k+" ["+l+"='lat']").val(""),a(k+" ["+l+"='lng']").val(""),a(i).val(""),a(m).hide(),a(i).geocomplete("resetLastValue"),!1})),a(m).hide()}var f={bounds:!0,country:null,map:!1,details:!1,detailsAttribute:"name",detailsScope:null,autoselect:!0,location:!1,addReset:!1,addPosition:!1,wrap:!0,mapOptions:{zoom:14,scrollwheel:!1,mapTypeId:"roadmap"},markerOptions:{draggable:!1},maxZoom:16,types:["geocode"],blur:!1,geocodeAfterResult:!1,restoreValueAfterBlur:!1},g="street_address route intersection political country administrative_area_level_1 administrative_area_level_2 administrative_area_level_3 colloquial_area locality sublocality neighborhood premise subpremise postal_code natural_feature airport park point_of_interest post_box street_number floor room lat lng viewport location formatted_address location_type bounds".split(" "),h="id place_id url website vicinity reference name rating international_phone_number icon formatted_phone_number".split(" ");a.extend(e.prototype,{init:function(){this.justStart=!0,this.initMap(),this.initMarker(),this.initGeocoder(),this.initDetails(),this.initLocation()},initMap:function(){return this.options.map?"function"==typeof this.options.map.setCenter?void(this.map=this.options.map):void(this.map=new google.maps.Map(a(this.options.map)[0],this.options.mapOptions),google.maps.event.addListener(this.map,"click",a.proxy(this.mapClicked,this)),google.maps.event.addListener(this.map,"dragend",a.proxy(this.mapDragged,this)),google.maps.event.addListener(this.map,"idle",a.proxy(this.mapIdle,this)),google.maps.event.addListener(this.map,"zoom_changed",a.proxy(this.mapZoomed,this))):void 0},initMarker:function(){if(this.map){var i=a.extend(this.options.markerOptions,{map:this.map});i.disabled||(this.marker=new google.maps.Marker(i),google.maps.event.addListener(this.marker,"dragend",a.proxy(this.markerDragged,this)))}},initGeocoder:function(){var j={types:this.options.types,bounds:!0===this.options.bounds?null:this.options.bounds,componentRestrictions:this.options.componentRestrictions};this.options.country&&(j.componentRestrictions={country:this.options.country}),a(this.input).is("input")&&(this.autocomplete=new google.maps.places.Autocomplete(this.input,j)),this.geocoder=new google.maps.Geocoder,a(this.input).is("input")&&this.map&&!0===this.options.bounds&&this.autocomplete.bindTo("bounds",this.map),a(this.input).is("input")&&google.maps.event.addListener(this.autocomplete,"place_changed",a.proxy(this.placeChanged,this)),this.$input.on("keypress."+this._name,function(k){if(13===k.keyCode)return!1}),!0===this.options.geocodeAfterResult&&this.$input.bind("keypress."+this._name,a.proxy(function(){9!=event.keyCode&&!0===this.selected&&(this.selected=!1)},this)),this.$input.bind("geocode."+this._name,a.proxy(function(){this.find()},this)),this.$input.bind("geocode:result."+this._name,a.proxy(function(){this.lastInputVal=this.$input.val()},this)),!0===this.options.blur&&this.$input.on("blur."+this._name,a.proxy(function(){!0===this.options.geocodeAfterResult&&!0===this.selected||(!0===this.options.restoreValueAfterBlur?setTimeout(a.proxy(this.restoreLastValue,this),500):this.find())},this))},initDetails:function(){function i(m){l[m]=j.find("["+k+"="+m+"]")}if(this.options.details){if(this.options.detailsScope)var j=a(this.input).parents(this.options.detailsScope).find(this.options.details);else var j=a(this.options.details);var k=this.options.detailsAttribute,l={};a.each(g,function(m,n){i(n),i(n+"_short")}),a.each(h,function(m,n){i(n)}),this.$details=j,this.details=l}},initLocation:function(){var j,i=this.options.location;return i?"string"==typeof i?void this.find(i):void(i instanceof Array&&(j=new google.maps.LatLng(i[0],i[1])),i instanceof google.maps.LatLng&&(j=i),j&&(this.map&&this.map.setCenter(j),this.marker&&this.marker.setPosition(j))):void 0},destroy:function(){this.map&&(google.maps.event.clearInstanceListeners(this.map),google.maps.event.clearInstanceListeners(this.marker)),this.autocomplete.unbindAll(),google.maps.event.clearInstanceListeners(this.autocomplete),google.maps.event.clearInstanceListeners(this.input),this.$input.removeData(),this.$input.off(this._name),this.$input.unbind("."+this._name)},find:function(i){this.geocode({address:i||this.$input.val()})},geocode:function(i){i.address&&(this.options.bounds&&!i.bounds&&(!0===this.options.bounds?i.bounds=this.map&&this.map.getBounds():i.bounds=this.options.bounds),this.options.country&&(i.region=this.options.country),this.geocoder.geocode(i,a.proxy(this.handleGeocode,this)))},selectFirstResult:function(){var i="";a(".pac-item-selected")[0]&&(i="-selected");var j=a(".pac-container:visible .pac-item"+i+":first span:nth-child(2)").text(),k=a(".pac-container:visible .pac-item"+i+":first span:nth-child(3)").text(),l=j;return k&&(l+=" - "+k),this.$input.val(l),l},restoreLastValue:function(){this.lastInputVal&&this.$input.val(this.lastInputVal)},resetLastValue:function(){this.lastInputVal=!1},handleGeocode:function(i,j){if(j===google.maps.GeocoderStatus.OK){var k=i[0];this.justStart&&0!=this.$input.val().length||this.$input.val(k.formatted_address),this.justStart=!1,this.update(k),1<i.length&&this.trigger("geocode:multiple",i)}else this.trigger("geocode:error",j)},trigger:function(i,j){this.$input.trigger(i,[j])},center:function(i){i.viewport?(this.map.fitBounds(i.viewport),this.map.getZoom()>this.options.maxZoom&&this.map.setZoom(this.options.maxZoom)):(this.map.setZoom(this.options.maxZoom),this.map.setCenter(i.location)),this.marker&&(this.marker.setPosition(i.location),this.marker.setAnimation(this.options.markerOptions.animation))},update:function(i){this.map&&(a(this.options.map).show(),a(this.options.map).is(":visible")&&a(this.options.map).attr("data-loaded","true"),this.initMap(),this.initMarker(),this.center(i.geometry)),this.$details&&this.fillDetails(i),this.trigger("geocode:result",i)},fillDetails:function(i){var j={},k=i.geometry,l=k.viewport,m=k.bounds;a.each(i.address_components,function(n,o){o.types[0];a.each(o.types,function(q,r){j[r]=o.long_name,j[r+"_short"]=o.short_name})}),a.each(h,function(n,o){j[o]=i[o]}),a.extend(j,{formatted_address:i.formatted_address,location_type:k.location_type||"PLACES",viewport:l,bounds:m,location:k.location,lat:k.location.lat(),lng:k.location.lng()}),a.each(this.details,a.proxy(function(n,o){var p=j[n];this.setDetail(o,p)},this)),this.data=j},setDetail:function(i,j){j===d?j="":"function"==typeof j.toUrlValue&&(j=j.toUrlValue()),i.is(":input")?i.val(j):i.text(j)},markerDragged:function(i){this.trigger("geocode:dragged",i.latLng),this.setDetail(this.details.lat,i.latLng.lat()),this.setDetail(this.details.lng,i.latLng.lng())},mapClicked:function(i){this.trigger("geocode:click",i.latLng)},mapDragged:function(){this.trigger("geocode:mapdragged",this.map.getCenter())},mapIdle:function(){this.trigger("geocode:idle",this.map.getCenter())},mapZoomed:function(){this.trigger("geocode:zoom",this.map.getZoom())},resetMarker:function(){this.marker.setPosition(this.data.location),this.setDetail(this.details.lat,this.data.location.lat()),this.setDetail(this.details.lng,this.data.location.lng())},placeChanged:function(){var i=this.autocomplete.getPlace();if(this.selected=!0,!!i.geometry)this.update(i);else if(this.options.autoselect){var j=this.selectFirstResult();this.find(j)}}}),a.fn.geocomplete=function(i){var j="plugin_geocomplete";if("string"==typeof i){var k=a(this).data(j)||a(this).geocomplete().data(j),l=k[i];return"function"==typeof l?(l.apply(k,Array.prototype.slice.call(arguments,1)),a(this)):(2==arguments.length&&(l=arguments[1]),l)}return this.each(function(){var m=a.data(this,j);m||(m=new e(this,i),a.data(this,j,m))})}})(jQuery,window,document);